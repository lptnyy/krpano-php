(function(e){function t(){this.type=null,this.stereo=null,this.hfov=360,this.vfov=180,this.voffset=0,this.cubesize=0,this.basename=null,this.images=[null,null,null,null,null,null,null,null,null,null,null,null]}function n(e,t){return e==t?0:e<t?-1:1}function r(e){if(e!=null){var t=(""+e).toLowerCase().charCodeAt(0);if(t>=48&&t<=57)return!0;if(t>=97&&t<=122)return!0}return!1}function i(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return n>t&&(t=n),t>=0?e.slice(0,t+1):e}function s(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return n>t&&(t=n),t>=0?e.slice(t+1):e}function o(e){var t=s(e),n=t.lastIndexOf(".");return n>0?t.slice(0,n):t}function u(e,t){var r=e.filepath,i=t.filepath,o=s(r).toLowerCase(),u=s(i).toLowerCase(),a=0,f=0,l=0,c=0,h=o.length,p=u.length,d,v;if(h>1){while(h>1&&o[h-1]!=".")h--;h--}if(p>1){while(p>1&&u[p-1]!=".")p--;p--}if(h<=0||p<=0)return n(o,u);for(d=0;d<h;d++){v=o[d];if(!(v>="0"&&v<="9"))break;a++}for(d=0;d<p;d++){v=u[d];if(!(v>="0"&&v<="9"))break;f++}for(d=h-1;d>0;d--){v=o[d];if(!(v>="0"&&v<="9"))break;l++}for(d=p-1;d>0;d--){v=u[d];if(!(v>="0"&&v<="9"))break;c++}var m=0,g=h-a-l,y=p-f-c;g<=0&&(g=0),y<=0&&(y=0);if(g==y){m=n(o.substr(a,g),u.substr(f,y));if(m==0){var b=0,w=0;if(a>0&&f>0){var E=parseInt(o),S=parseInt(u);b=E-S}if(l>0&&c>0){var E=parseInt(o.slice(a+g)),S=parseInt(u.slice(f+y));w=E-S}if(b!=0)return b;if(w!=0)return w}}return n(o,u)}function a(e){var t=o(e),n=t.toLowerCase(),s="lfrbud",u=null,a=null,f=null,l="_-.",c=n.slice(-2);for(var h=0;h<l.length;h++)for(var p=0;p<6;p++){var d=l[h]+s[p];if(c==d){u=s[p],a=t.slice(0,-2),f=d,h=l.length;break}}if(u==null){var v=[["left",0],["front",1],["right",2],["back",3],["up",4],["top",4],["down",5],["bottom",5]];for(var p=0;p<v.length;p++){var m=v[p][0],g=n.indexOf(m);if(g>=0){var y=n[g-1],b=n[g+m.length],w=r(y),E=r(b);if(!w&&!E){u=s[v[p][1]];var S=g,x=g+m.length;while(S>0&&!r(n[S-1]))S--;while(x<n.length-1&&!r(n[x]))x++;a=t.slice(0,S)+t.slice(x),f=n.slice(S,x);if(a==""){a="$"+a;var T=i(e).toLowerCase();for(var h=0;h<e.length;h++)r(T[h])&&(a+=T[h])}break}}}}return u?{side:u,index:s.indexOf(u),basename:a,sideid:f}:null}function f(e,t){if(e.cube&&t.cube){var r=n(e.cube.basename,t.cube.basename);if(r==0){if(e.cube.index<t.cube.index)return-1;if(e.cube.index>t.cube.index)return 1}return r}return e.cube&&!t.cube?-1:!e.cube&&t.cube?1:u(e,t)}function l(e,t){var n=0,r=0,i;for(i=0;i<12;i++)if(e.images[i]){n=e.images[i].inputorder;break}for(i=0;i<12;i++)if(t.images[i]){r=t.images[i].inputorder;break}return n<r?-1:n>r?1:0}e.detect_sets=function(e,n){e.sort(u);for(var r=0;r<e.length;r++){e[r].inputorder=r;var i=e[r].pinginfo;i.w==i.h?e[r].cube=a(e[r].filepath):e[r].cube=null}e.sort(f);var s=[],c=null;for(var r=0;r<e.length;r++){var h=e[r],i=h.pinginfo,p=h.cube;if(p){var d=0,v=0;if(i.comment){var m=i.comment;if(m.indexOf("krpano;spheretocube;spheresize=")==0){var g=m.slice(31).split("x");d=parseInt(g[0]),v=parseInt(g[1])}}if(c==null||c.type!="cube"||c.basename!=p.basename||c.cubesize!=i.w){var y=new t;y.type="cube",y.cubesize=i.w,y.spheresize_w=Math.round(i.w*Math.PI),y.spheresize_h=Math.round(y.spheresize_w/2),y.basename=p.basename,y.images[p.index]=h,s.push(y),c=y}else c.images[p.index]=h;d>0&&v>0&&(c.spheresize_w=d,c.spheresize_h=v)}else{c=null;var y=new t;y.type="sphere",y.basename=o(h.filepath),y.vfov=0,y.images[0]=h,y.spheresize_w=i.w,y.spheresize_h=i.h,y.cubesize=Math.round(y.spheresize_w/Math.PI),s.push(y)}}return s.sort(l),s.length>0?s:null}})(window.cube_sphere_detector=window.cube_sphere_detector||{})